cd /var/www/cryptorafts && echo "ðŸ”§ ADDING API KEYS - PERFECT CONFIGURATION" && echo "========================================" && echo "" && echo "ðŸ“‹ Step 1: Creating .env.local with your API keys..." && cat > .env.local << 'ENVEOF'
# ============================================
# OPENAI CONFIGURATION (REQUIRED)
# ============================================
OPENAI_API_KEY=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

# ============================================
# FIREBASE CONFIGURATION (REQUIRED)
# ============================================
NEXT_PUBLIC_FIREBASE_API_KEY=AIzaSyBcuVT24UBPUB_U78FGQ04D2BqH6N-4M4E
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=cryptorafts-b9067.firebaseapp.com
NEXT_PUBLIC_FIREBASE_PROJECT_ID=cryptorafts-b9067
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=cryptorafts-b9067.firebasestorage.app
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=374711838796
NEXT_PUBLIC_FIREBASE_APP_ID=1:374711838796:web:3bee725bfa7d8790456ce9

# ============================================
# APP CONFIGURATION
# ============================================
NEXT_PUBLIC_APP_URL=https://www.cryptorafts.com
NODE_ENV=production

# ============================================
# SOCIAL SHARE SERVICE (OPTIONAL)
# ============================================
# Configure at least one platform to enable auto-sharing

# Buffer (Multi-platform scheduling)
# BUFFER_ACCESS_TOKEN=your_buffer_access_token
# BUFFER_PROFILE_IDS=profile1,profile2

# Twitter/X (API v2)
# TWITTER_API_KEY=your_twitter_api_key
# TWITTER_API_SECRET=your_twitter_api_secret
# TWITTER_ACCESS_TOKEN=your_twitter_access_token
# TWITTER_ACCESS_TOKEN_SECRET=your_twitter_access_token_secret

# Facebook (Pages)
# FACEBOOK_APP_ID=your_facebook_app_id
# FACEBOOK_APP_SECRET=your_facebook_app_secret
# FACEBOOK_PAGE_ACCESS_TOKEN=your_facebook_page_access_token

# LinkedIn (Company Pages)
# LINKEDIN_CLIENT_ID=your_linkedin_client_id
# LINKEDIN_CLIENT_SECRET=your_linkedin_client_secret
# LINKEDIN_ACCESS_TOKEN=your_linkedin_access_token

# Telegram (Bot Messages)
# TELEGRAM_BOT_TOKEN=your_telegram_bot_token
# TELEGRAM_CHAT_ID=your_telegram_chat_id
ENVEOF
chmod 600 .env.local && echo "âœ… .env.local created with API keys (secure permissions)" && echo "" && echo "ðŸ“‹ Step 2: Updating server.js to load .env.local..." && cat > server.js << 'EOFSERVER'
require('dotenv').config({ path: '.env.local' });
const { createServer } = require('http');
const { parse } = require('url');
const next = require('next');
const dev = process.env.NODE_ENV !== 'production';
const port = parseInt(process.env.PORT || '3000', 10);
const app = next({ dev, hostname: '0.0.0.0', port });
const handle = app.getRequestHandler();
app.prepare().then(() => {
  createServer(async (req, res) => {
    try {
      const parsedUrl = parse(req.url, true);
      await handle(req, res, parsedUrl);
    } catch (err) {
      console.error('Error occurred handling', req.url, err);
      res.statusCode = 500;
      res.end('internal server error');
    }
  })
    .once('error', (err) => {
      console.error(err);
      process.exit(1);
    })
    .listen(port, '0.0.0.0', () => {
      console.log(`> Ready on http://0.0.0.0:${port}`);
    });
});
EOFSERVER
echo "âœ… server.js updated to load .env.local" && echo "" && echo "ðŸ“‹ Step 3: Installing dotenv if not present..." && npm list dotenv > /dev/null 2>&1 || npm install dotenv --save --quiet && echo "âœ… dotenv installed" && echo "" && echo "ðŸ“‹ Step 4: Updating ecosystem.config.js..." && NODE_PATH=$(which node) && cat > ecosystem.config.js << EOF
module.exports = {
  apps: [{
    name: 'cryptorafts',
    script: './server.js',
    instances: 1,
    exec_mode: 'fork',
    interpreter: '${NODE_PATH}',
    env: {
      NODE_ENV: 'production',
      PORT: 3000,
      NEXT_PUBLIC_APP_URL: 'https://www.cryptorafts.com',
    },
    error_file: './logs/pm2-error.log',
    out_file: './logs/pm2-out.log',
    log_date_format: 'YYYY-MM-DD HH:mm:ss Z',
    merge_logs: true,
    autorestart: true,
    watch: false,
    max_memory_restart: '1G',
    min_uptime: '10s',
    max_restarts: 10,
    restart_delay: 4000,
  }],
};
EOF
echo "âœ… ecosystem.config.js updated" && echo "" && echo "ðŸ“‹ Step 5: Restarting PM2 with new API keys..." && pm2 stop cryptorafts && pm2 delete cryptorafts && pm2 start ecosystem.config.js && pm2 save && sleep 15 && echo "âœ… PM2 restarted" && echo "" && echo "ðŸ“‹ Step 6: Checking PM2 logs for API key status..." && sleep 3 && pm2 logs cryptorafts --lines 15 --nostream | grep -E "(OpenAI|Social Share|Firebase)" || echo "Checking logs..." && echo "" && echo "âœ… API KEYS ADDED SUCCESSFULLY!" && echo "========================================" && echo "" && echo "âœ… OpenAI API Key: Configured" && echo "âœ… Firebase API Key: Configured" && echo "" && echo "ðŸ“‹ Verification:" && echo "PM2 Status:" && pm2 status cryptorafts && echo "" && echo "Recent Logs:" && pm2 logs cryptorafts --lines 5 --nostream && echo "" && echo "ðŸŒ Your app is ready with API keys!" && echo "Visit: https://www.cryptorafts.com" && echo "" && echo "âœ… All warnings should be gone now!"

